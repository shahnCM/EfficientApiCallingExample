<?php

namespace Tests\Unit;

use Carbon\Carbon;
use Tests\TestCase;
use App\Http\Services\CompanyService;

class CompanyServiceTest extends TestCase
{
    public function testGetCompanySymbolList()
    {
        $companyService = new CompanyService();

        $symbolList = $companyService->getCompanySymbolList();

        $this->assertIsArray($symbolList);
        $this->assertNotEmpty($symbolList);
        $this->assertArrayHasKey('GOOG', $symbolList);
    }

    public function testGetHistoryDataByCompanySymbol()
    {
        $companyService = new CompanyService();

        $symbol = 'GOOG';
        $region = 'US';

        $historyData = $companyService->getHistoryDataByCompanySymbol($symbol, $region);
        $this->assertIsArray($historyData);
        $this->assertNotEmpty($historyData);
    }

    public function testFilterHistoryDataByDateRange()
    {
        $companyService = new CompanyService();

        $jsonString = '[{"date":1687527000,"open":122.04000091552734,"high":123.44000244140625,"low":121.86000061035156,"close":123.0199966430664,"volume":29542900,"adjclose":123.0199966430664},{"date":1687440600,"open":120.66000366210938,"high":123.93499755859375,"low":119.5999984741211,"close":123.87000274658203,"volume":20781900,"adjclose":123.87000274658203},{"date":1687354200,"open":123.23500061035156,"high":123.41000366210938,"low":120.86000061035156,"close":121.26000213623047,"volume":22612000,"adjclose":121.26000213623047},{"date":1687267800,"open":123.53500366210938,"high":125.17500305175781,"low":122.83000183105469,"close":123.8499984741211,"volume":22698000,"adjclose":123.8499984741211},{"date":1686922200,"open":126.69999694824219,"high":126.69999694824219,"low":123.79000091552734,"close":124.05999755859375,"volume":56686800,"adjclose":124.05999755859375},{"date":1686835800,"open":123.87999725341797,"high":126.16000366210938,"low":123.13999938964844,"close":125.79000091552734,"volume":24517100,"adjclose":125.79000091552734},{"date":1686749400,"open":123.80000305175781,"high":124.79000091552734,"low":122.16000366210938,"close":124.37999725341797,"volume":24659600,"adjclose":124.37999725341797},{"date":1686663000,"open":125.6500015258789,"high":125.86000061035156,"low":123.84500122070312,"close":124.43000030517578,"volume":19287700,"adjclose":124.43000030517578},{"date":1686576600,"open":123.3949966430664,"high":124.75,"low":122.3499984741211,"close":124.3499984741211,"volume":22255700,"adjclose":124.3499984741211},{"date":1686317400,"open":122.55999755859375,"high":124.28500366210938,"low":122.41999816894531,"close":122.87000274658203,"volume":20304500,"adjclose":122.87000274658203},{"date":1686231000,"open":122.58499908447266,"high":123.7300033569336,"low":122.01000213623047,"close":122.66999816894531,"volume":24815000,"adjclose":122.66999816894531},{"date":1686144600,"open":127.57499694824219,"high":129.5500030517578,"low":122.62999725341797,"close":122.94000244140625,"volume":34179300,"adjclose":122.94000244140625},{"date":1686058200,"open":126.5999984741211,"high":128.8800048828125,"low":125.97000122070312,"close":127.91000366210938,"volume":19450100,"adjclose":127.91000366210938},{"date":1685971800,"open":124.61000061035156,"high":127.98999786376953,"low":124.37999725341797,"close":126.62999725341797,"volume":22672500,"adjclose":126.62999725341797},{"date":1685712600,"open":124.48999786376953,"high":126.74500274658203,"low":124.3499984741211,"close":125.2300033569336,"volume":19362400,"adjclose":125.2300033569336},{"date":1685626200,"open":123.5,"high":125.04000091552734,"low":123.30000305175781,"close":124.37000274658203,"volume":25017700,"adjclose":124.37000274658203},{"date":1685539800,"open":123.69999694824219,"high":124.9000015258789,"low":123.0999984741211,"close":123.37000274658203,"volume":41548800,"adjclose":123.37000274658203},{"date":1685453400,"open":126.29000091552734,"high":126.37999725341797,"low":122.88999938964844,"close":124.63999938964844,"volume":27230700,"adjclose":124.63999938964844},{"date":1685107800,"open":124.06500244140625,"high":126,"low":123.29000091552734,"close":125.43000030517578,"volume":25154700,"adjclose":125.43000030517578},{"date":1685021400,"open":125.20999908447266,"high":125.9800033569336,"low":122.9000015258789,"close":124.3499984741211,"volume":33812700,"adjclose":124.3499984741211},{"date":1684935000,"open":121.87999725341797,"high":122.75,"low":120.75,"close":121.63999938964844,"volume":23087900,"adjclose":121.63999938964844},{"date":1684848600,"open":124.93000030517578,"high":125.41999816894531,"low":123.05000305175781,"close":123.29000091552734,"volume":24477900,"adjclose":123.29000091552734},{"date":1684762200,"open":123.51000213623047,"high":127.05000305175781,"low":123.44999694824219,"close":125.87000274658203,"volume":29760200,"adjclose":125.87000274658203},{"date":1684503000,"open":124.19999694824219,"high":126.47899627685547,"low":122.72000122070312,"close":123.25,"volume":30251300,"adjclose":123.25},{"date":1684416600,"open":121.55999755859375,"high":123.9000015258789,"low":121.48999786376953,"close":123.5199966430664,"volume":27014500,"adjclose":123.5199966430664},{"date":1684330200,"open":120.18000030517578,"high":122.27999877929688,"low":119.45999908447266,"close":121.4800033569336,"volume":26659600,"adjclose":121.4800033569336},{"date":1684243800,"open":116.83000183105469,"high":121.19999694824219,"low":116.83000183105469,"close":120.08999633789062,"volume":32370100,"adjclose":120.08999633789062},{"date":1684157400,"open":116.48999786376953,"high":118.79499816894531,"low":116.4800033569336,"close":116.95999908447266,"volume":22107900,"adjclose":116.95999908447266},{"date":1683898200,"open":117,"high":118.26000213623047,"low":116.55000305175781,"close":117.91999816894531,"volume":31272500,"adjclose":117.91999816894531},{"date":1683811800,"open":115.86000061035156,"high":118.44000244140625,"low":114.93000030517578,"close":116.9000015258789,"volume":57115100,"adjclose":116.9000015258789},{"date":1683725400,"open":108.55000305175781,"high":113.51000213623047,"low":108.4800033569336,"close":112.27999877929688,"volume":47533500,"adjclose":112.27999877929688},{"date":1683639000,"open":108.77999877929688,"high":110.59500122070312,"low":107.7249984741211,"close":107.94000244140625,"volume":24782400,"adjclose":107.94000244140625},{"date":1683552600,"open":105.79499816894531,"high":108.41999816894531,"low":105.79000091552734,"close":108.23999786376953,"volume":17266000,"adjclose":108.23999786376953},{"date":1683293400,"open":105.31999969482422,"high":106.44000244140625,"low":104.73899841308594,"close":106.21499633789062,"volume":20705300,"adjclose":106.21499633789062},{"date":1683207000,"open":106.16000366210938,"high":106.30000305175781,"low":104.69999694824219,"close":105.20999908447266,"volume":19780600,"adjclose":105.20999908447266},{"date":1683120600,"open":106.22000122070312,"high":108.12999725341797,"low":105.62000274658203,"close":106.12000274658203,"volume":17116300,"adjclose":106.12000274658203},{"date":1683034200,"open":107.66000366210938,"high":107.7300033569336,"low":104.5,"close":105.9800033569336,"volume":20343100,"adjclose":105.9800033569336},{"date":1682947800,"open":107.72000122070312,"high":108.68000030517578,"low":107.5,"close":107.70999908447266,"volume":20926300,"adjclose":107.70999908447266},{"date":1682688600,"open":107.80000305175781,"high":108.29000091552734,"low":106.04000091552734,"close":108.22000122070312,"volume":23957900,"adjclose":108.22000122070312},{"date":1682602200,"open":105.2300033569336,"high":109.1500015258789,"low":104.41999816894531,"close":108.37000274658203,"volume":38235200,"adjclose":108.37000274658203},{"date":1682515800,"open":105.55999755859375,"high":107.0199966430664,"low":103.2699966430664,"close":104.44999694824219,"volume":37068200,"adjclose":104.44999694824219},{"date":1682429400,"open":106.61000061035156,"high":107.44000244140625,"low":104.55999755859375,"close":104.61000061035156,"volume":31408100,"adjclose":104.61000061035156},{"date":1682343000,"open":106.05000305175781,"high":107.31999969482422,"low":105.36000061035156,"close":106.77999877929688,"volume":21410900,"adjclose":106.77999877929688},{"date":1682083800,"open":106.08999633789062,"high":106.63999938964844,"low":105.48500061035156,"close":105.91000366210938,"volume":22379000,"adjclose":105.91000366210938},{"date":1681997400,"open":104.6500015258789,"high":106.88800048828125,"low":104.63999938964844,"close":105.9000015258789,"volume":22515300,"adjclose":105.9000015258789},{"date":1681911000,"open":104.21499633789062,"high":105.7249984741211,"low":103.80000305175781,"close":105.0199966430664,"volume":16732000,"adjclose":105.0199966430664},{"date":1681824600,"open":107,"high":107.05000305175781,"low":104.77999877929688,"close":105.12000274658203,"volume":17641400,"adjclose":105.12000274658203},{"date":1681738200,"open":105.43000030517578,"high":106.70999908447266,"low":105.31999969482422,"close":106.41999816894531,"volume":29043400,"adjclose":106.41999816894531},{"date":1681479000,"open":107.69000244140625,"high":109.58000183105469,"low":107.58999633789062,"close":109.45999908447266,"volume":20758700,"adjclose":109.45999908447266},{"date":1681392600,"open":106.47000122070312,"high":108.26499938964844,"low":106.44000244140625,"close":108.19000244140625,"volume":21650700,"adjclose":108.19000244140625},{"date":1681306200,"open":107.38999938964844,"high":107.58699798583984,"low":104.97000122070312,"close":105.22000122070312,"volume":22761600,"adjclose":105.22000122070312},{"date":1681219800,"open":106.91999816894531,"high":107.22000122070312,"low":105.27999877929688,"close":106.12000274658203,"volume":18721300,"adjclose":106.12000274658203},{"date":1681133400,"open":107.38999938964844,"high":107.97000122070312,"low":105.5999984741211,"close":106.94999694824219,"volume":19741500,"adjclose":106.94999694824219},{"date":1680787800,"open":105.7699966430664,"high":109.62999725341797,"low":104.81500244140625,"close":108.9000015258789,"volume":34684200,"adjclose":108.9000015258789},{"date":1680701400,"open":106.12000274658203,"high":106.54000091552734,"low":104.10199737548828,"close":104.94999694824219,"volume":21864200,"adjclose":104.94999694824219},{"date":1680615000,"open":104.83999633789062,"high":106.0999984741211,"low":104.5999984741211,"close":105.12000274658203,"volume":20377200,"adjclose":105.12000274658203},{"date":1680528600,"open":102.66999816894531,"high":104.94999694824219,"low":102.37999725341797,"close":104.91000366210938,"volume":20719900,"adjclose":104.91000366210938},{"date":1680269400,"open":101.70999908447266,"high":104.19000244140625,"low":101.44000244140625,"close":104,"volume":28108000,"adjclose":104},{"date":1680183000,"open":101.44000244140625,"high":101.61000061035156,"low":100.29000091552734,"close":101.31999969482422,"volume":25009800,"adjclose":101.31999969482422},{"date":1680096600,"open":102.72000122070312,"high":102.81999969482422,"low":101.02999877929688,"close":101.9000015258789,"volume":26148300,"adjclose":101.9000015258789},{"date":1680010200,"open":103,"high":103,"low":100.27999877929688,"close":101.36000061035156,"volume":24913500,"adjclose":101.36000061035156},{"date":1679923800,"open":105.31999969482422,"high":105.4000015258789,"low":102.62999725341797,"close":103.05999755859375,"volume":25393400,"adjclose":103.05999755859375},{"date":1679664600,"open":105.73999786376953,"high":106.16000366210938,"low":104.73999786376953,"close":106.05999755859375,"volume":25236200,"adjclose":106.05999755859375},{"date":1679578200,"open":105.88999938964844,"high":107.10099792480469,"low":105.41000366210938,"close":106.26000213623047,"volume":31385800,"adjclose":106.26000213623047},{"date":1679491800,"open":105.13999938964844,"high":107.51000213623047,"low":104.20999908447266,"close":104.22000122070312,"volume":32336900,"adjclose":104.22000122070312},{"date":1679405400,"open":101.9800033569336,"high":105.95999908447266,"low":101.86000061035156,"close":105.83999633789062,"volume":33122800,"adjclose":105.83999633789062},{"date":1679319000,"open":101.05999755859375,"high":102.58000183105469,"low":100.79000091552734,"close":101.93000030517578,"volume":26033900,"adjclose":101.93000030517578},{"date":1679059800,"open":100.83999633789062,"high":103.48999786376953,"low":100.75,"close":102.45999908447266,"volume":76140300,"adjclose":102.45999908447266},{"date":1678973400,"open":96.56999969482422,"high":101.97000122070312,"low":95.87000274658203,"close":101.06999969482422,"volume":54499500,"adjclose":101.06999969482422},{"date":1678887000,"open":93.54000091552734,"high":97.25,"low":93.04000091552734,"close":96.55000305175781,"volume":38367300,"adjclose":96.55000305175781},{"date":1678800600,"open":93.06999969482422,"high":94.83000183105469,"low":92.77999877929688,"close":94.25,"volume":32303900,"adjclose":94.25},{"date":1678714200,"open":90.56500244140625,"high":93.08000183105469,"low":89.94000244140625,"close":91.66000366210938,"volume":31508600,"adjclose":91.66000366210938},{"date":1678458600,"open":92.5,"high":93.18000030517578,"low":90.80000305175781,"close":91.01000213623047,"volume":32850100,"adjclose":91.01000213623047},{"date":1678372200,"open":94.48999786376953,"high":95.91999816894531,"low":92.3550033569336,"close":92.66000366210938,"volume":24438900,"adjclose":92.66000366210938},{"date":1678285800,"open":94.40499877929688,"high":96.23999786376953,"low":94.40499877929688,"close":94.6500015258789,"volume":25395200,"adjclose":94.6500015258789},{"date":1678199400,"open":95.41999816894531,"high":96.08999633789062,"low":93.84400177001953,"close":94.16999816894531,"volume":24101500,"adjclose":94.16999816894531},{"date":1678113000,"open":94.36000061035156,"high":96.30000305175781,"low":94.30000305175781,"close":95.58000183105469,"volume":28288200,"adjclose":95.58000183105469},{"date":1677853800,"open":92.73999786376953,"high":94.11000061035156,"low":92.66000366210938,"close":94.0199966430664,"volume":30242500,"adjclose":94.0199966430664},{"date":1677767400,"open":89.86000061035156,"high":92.4800033569336,"low":89.7699966430664,"close":92.30999755859375,"volume":23328600,"adjclose":92.30999755859375},{"date":1677681000,"open":90.16000366210938,"high":91.19999694824219,"low":89.8499984741211,"close":90.51000213623047,"volume":26323900,"adjclose":90.51000213623047},{"date":1677594600,"open":89.54000091552734,"high":91.44999694824219,"low":89.5199966430664,"close":90.30000305175781,"volume":30546900,"adjclose":90.30000305175781},{"date":1677508200,"open":90.08999633789062,"high":90.44999694824219,"low":89.61000061035156,"close":90.0999984741211,"volume":22724300,"adjclose":90.0999984741211},{"date":1677249000,"open":89.62999725341797,"high":90.12999725341797,"low":88.86000061035156,"close":89.3499984741211,"volume":31295600,"adjclose":89.3499984741211},{"date":1677162600,"open":92.12999725341797,"high":92.12999725341797,"low":90.01000213623047,"close":91.06999969482422,"volume":32423700,"adjclose":91.06999969482422},{"date":1677076200,"open":91.93399810791016,"high":92.36000061035156,"low":90.87000274658203,"close":91.80000305175781,"volume":29891100,"adjclose":91.80000305175781},{"date":1676989800,"open":93.23999786376953,"high":93.41500091552734,"low":92,"close":92.05000305175781,"volume":28367200,"adjclose":92.05000305175781},{"date":1676644200,"open":95.06999969482422,"high":95.75,"low":93.44999694824219,"close":94.58999633789062,"volume":31095100,"adjclose":94.58999633789062},{"date":1676557800,"open":95.54000091552734,"high":97.87999725341797,"low":94.97000122070312,"close":95.77999877929688,"volume":35642100,"adjclose":95.77999877929688},{"date":1676471400,"open":94.73999786376953,"high":97.33999633789062,"low":94.36000061035156,"close":97.0999984741211,"volume":36964500,"adjclose":97.0999984741211},{"date":1676385000,"open":94.66000366210938,"high":95.17500305175781,"low":92.6500015258789,"close":94.94999694824219,"volume":42513100,"adjclose":94.94999694824219},{"date":1676298600,"open":95.01000213623047,"high":95.3499984741211,"low":94.05000305175781,"close":95,"volume":43116600,"adjclose":95},{"date":1676039400,"open":95.73999786376953,"high":97.0199966430664,"low":94.52999877929688,"close":94.86000061035156,"volume":49325300,"adjclose":94.86000061035156},{"date":1675953000,"open":100.54000091552734,"high":100.61000061035156,"low":93.86000061035156,"close":95.45999908447266,"volume":97798600,"adjclose":95.45999908447266},{"date":1675866600,"open":102.69000244140625,"high":103.58000183105469,"low":98.45500183105469,"close":100,"volume":73546000,"adjclose":100},{"date":1675780200,"open":103.62999725341797,"high":108.66999816894531,"low":103.5479965209961,"close":108.04000091552734,"volume":33738800,"adjclose":108.04000091552734},{"date":1675693800,"open":102.68499755859375,"high":104.69999694824219,"low":102.20999908447266,"close":103.47000122070312,"volume":25573000,"adjclose":103.47000122070312},{"date":1675434600,"open":103.51000213623047,"high":108.0199966430664,"low":103.30000305175781,"close":105.22000122070312,"volume":36823400,"adjclose":105.22000122070312},{"date":1675348200,"open":106.79000091552734,"high":108.81999969482422,"low":106.54000091552734,"close":108.80000305175781,"volume":46622600,"adjclose":108.80000305175781},{"date":1675261800,"open":99.73999786376953,"high":102.19000244140625,"low":98.41999816894531,"close":101.43000030517578,"volume":26392600,"adjclose":101.43000030517578},{"date":1675175400,"open":97.86000061035156,"high":99.91000366210938,"low":97.79000091552734,"close":99.87000274658203,"volume":22306800,"adjclose":99.87000274658203},{"date":1675089000,"open":98.74500274658203,"high":99.40899658203125,"low":97.5199966430664,"close":97.94999694824219,"volume":24365100,"adjclose":97.94999694824219},{"date":1674829800,"open":99.05000305175781,"high":101.58000183105469,"low":98.97000122070312,"close":100.70999908447266,"volume":29020400,"adjclose":100.70999908447266},{"date":1674743400,"open":98.27999877929688,"high":99.20999908447266,"low":96.81999969482422,"close":99.16000366210938,"volume":24542100,"adjclose":99.16000366210938},{"date":1674657000,"open":97.19999694824219,"high":97.72000122070312,"low":95.26200103759766,"close":96.7300033569336,"volume":31000900,"adjclose":96.7300033569336},{"date":1674570600,"open":99.55000305175781,"high":101.08999633789062,"low":98.69999694824219,"close":99.20999908447266,"volume":27391400,"adjclose":99.20999908447266},{"date":1674484200,"open":99.12999725341797,"high":101.4000015258789,"low":98.75,"close":101.20999908447266,"volume":31791800,"adjclose":101.20999908447266},{"date":1674225000,"open":95.94999694824219,"high":99.41999816894531,"low":95.91000366210938,"close":99.27999877929688,"volume":53704800,"adjclose":99.27999877929688},{"date":1674138600,"open":91.38999938964844,"high":94.4000015258789,"low":91.37999725341797,"close":93.91000366210938,"volume":28707700,"adjclose":93.91000366210938},{"date":1674052200,"open":92.94000244140625,"high":93.58799743652344,"low":91.4000015258789,"close":91.77999877929688,"volume":19641600,"adjclose":91.77999877929688},{"date":1673965800,"open":92.77999877929688,"high":92.97000122070312,"low":90.83999633789062,"close":92.16000366210938,"volume":22935800,"adjclose":92.16000366210938},{"date":1673620200,"open":91.52799987792969,"high":92.9800033569336,"low":90.93000030517578,"close":92.80000305175781,"volume":18630700,"adjclose":92.80000305175781},{"date":1673533800,"open":92.4000015258789,"high":92.62000274658203,"low":90.56999969482422,"close":91.91000366210938,"volume":22754200,"adjclose":91.91000366210938},{"date":1673447400,"open":90.05999755859375,"high":92.44999694824219,"low":89.73999786376953,"close":92.26000213623047,"volume":25998800,"adjclose":92.26000213623047},{"date":1673361000,"open":86.72000122070312,"high":89.4749984741211,"low":86.69999694824219,"close":89.23999786376953,"volume":22855600,"adjclose":89.23999786376953},{"date":1673274600,"open":89.19499969482422,"high":90.83000183105469,"low":88.58000183105469,"close":88.80000305175781,"volume":22996700,"adjclose":88.80000305175781},{"date":1673015400,"open":87.36000061035156,"high":88.47000122070312,"low":85.56999969482422,"close":88.16000366210938,"volume":26612600,"adjclose":88.16000366210938},{"date":1672929000,"open":88.06999969482422,"high":88.20999908447266,"low":86.55999755859375,"close":86.7699966430664,"volume":23136100,"adjclose":86.7699966430664},{"date":1672842600,"open":91.01000213623047,"high":91.23999786376953,"low":87.80000305175781,"close":88.70999908447266,"volume":27046500,"adjclose":88.70999908447266},{"date":1672756200,"open":89.83000183105469,"high":91.55000305175781,"low":89.0199966430664,"close":89.69999694824219,"volume":20738500,"adjclose":89.69999694824219},{"date":1672410600,"open":87.36499786376953,"high":88.83000183105469,"low":87.02999877929688,"close":88.7300033569336,"volume":19190300,"adjclose":88.7300033569336},{"date":1672324200,"open":87.02999877929688,"high":89.36499786376953,"low":86.98999786376953,"close":88.94999694824219,"volume":18280700,"adjclose":88.94999694824219},{"date":1672237800,"open":87.5,"high":88.5199966430664,"low":86.37000274658203,"close":86.45999908447266,"volume":17879600,"adjclose":86.45999908447266},{"date":1672151400,"open":89.30999755859375,"high":89.5,"low":87.53500366210938,"close":87.93000030517578,"volume":15470900,"adjclose":87.93000030517578},{"date":1671805800,"open":87.62000274658203,"high":90.0999984741211,"low":87.62000274658203,"close":89.80999755859375,"volume":17815000,"adjclose":89.80999755859375},{"date":1671719400,"open":88.93000030517578,"high":89.18000030517578,"low":86.94000244140625,"close":88.26000213623047,"volume":23656100,"adjclose":88.26000213623047},{"date":1671633000,"open":89.7300033569336,"high":90.91500091552734,"low":88.91000366210938,"close":90.25,"volume":20336400,"adjclose":90.25},{"date":1671546600,"open":88.7300033569336,"high":89.77999877929688,"low":88.04000091552734,"close":89.62999725341797,"volume":21976800,"adjclose":89.62999725341797},{"date":1671460200,"open":90.87999725341797,"high":91.19999694824219,"low":88.92500305175781,"close":89.1500015258789,"volume":23020500,"adjclose":89.1500015258789},{"date":1671201000,"open":91.19999694824219,"high":91.75,"low":90.01000213623047,"close":90.86000061035156,"volume":48485500,"adjclose":90.86000061035156},{"date":1671114600,"open":93.54000091552734,"high":94.02999877929688,"low":90.43000030517578,"close":91.19999694824219,"volume":28298800,"adjclose":91.19999694824219},{"date":1671028200,"open":95.54000091552734,"high":97.22000122070312,"low":93.94000244140625,"close":95.30999755859375,"volume":26452900,"adjclose":95.30999755859375},{"date":1670941800,"open":98.06999969482422,"high":99.80000305175781,"low":95.37999725341797,"close":95.8499984741211,"volume":34788500,"adjclose":95.8499984741211},{"date":1670855400,"open":93.08999633789062,"high":93.875,"low":91.9000015258789,"close":93.55999755859375,"volume":27380900,"adjclose":93.55999755859375},{"date":1670596200,"open":93.9000015258789,"high":94.48999786376953,"low":93.0199966430664,"close":93.06999969482422,"volume":21885300,"adjclose":93.06999969482422},{"date":1670509800,"open":95.69000244140625,"high":95.87000274658203,"low":93.80000305175781,"close":93.94999694824219,"volume":25593200,"adjclose":93.94999694824219},{"date":1670423400,"open":96.7699966430664,"high":97.30999755859375,"low":95.0250015258789,"close":95.1500015258789,"volume":26647900,"adjclose":95.1500015258789},{"date":1670337000,"open":99.66999816894531,"high":100.20999908447266,"low":96.76000213623047,"close":97.30999755859375,"volume":20877600,"adjclose":97.30999755859375},{"date":1670250600,"open":99.81500244140625,"high":101.75,"low":99.3550033569336,"close":99.87000274658203,"volume":19955500,"adjclose":99.87000274658203},{"date":1669991400,"open":99.37000274658203,"high":101.1500015258789,"low":99.16999816894531,"close":100.83000183105469,"volume":18821500,"adjclose":100.83000183105469},{"date":1669905000,"open":101.4000015258789,"high":102.58999633789062,"low":100.66999816894531,"close":101.27999877929688,"volume":21771500,"adjclose":101.27999877929688},{"date":1669818600,"open":95.12000274658203,"high":101.44999694824219,"low":94.66999816894531,"close":101.44999694824219,"volume":39888100,"adjclose":101.44999694824219},{"date":1669732200,"open":96,"high":96.38999938964844,"low":94.38999938964844,"close":95.44000244140625,"volume":20220000,"adjclose":95.44000244140625},{"date":1669645800,"open":97.19999694824219,"high":97.83000183105469,"low":95.88999938964844,"close":96.25,"volume":19974500,"adjclose":96.25},{"date":1669386600,"open":98.46499633789062,"high":98.94000244140625,"low":97.52999877929688,"close":97.5999984741211,"volume":8567800,"adjclose":97.5999984741211},{"date":1669213800,"open":97.33999633789062,"high":99.06900024414062,"low":97.33999633789062,"close":98.81999969482422,"volume":17568900,"adjclose":98.81999969482422},{"date":1669127400,"open":96.16000366210938,"high":97.5479965209961,"low":94.41000366210938,"close":97.33000183105469,"volume":18868900,"adjclose":97.33000183105469},{"date":1669041000,"open":97.55999755859375,"high":98.72000122070312,"low":95.66999816894531,"close":95.83000183105469,"volume":18696900,"adjclose":95.83000183105469},{"date":1668781800,"open":99.01000213623047,"high":99.16000366210938,"low":96.73999786376953,"close":97.80000305175781,"volume":24969900,"adjclose":97.80000305175781},{"date":1668695400,"open":97.18000030517578,"high":99.4800033569336,"low":97.0999984741211,"close":98.5,"volume":21818700,"adjclose":98.5},{"date":1668609000,"open":98.0199966430664,"high":99.8499984741211,"low":97.9020004272461,"close":98.98999786376953,"volume":24660200,"adjclose":98.98999786376953},{"date":1668522600,"open":98.66999816894531,"high":100.41999816894531,"low":97.0199966430664,"close":98.72000122070312,"volume":31831000,"adjclose":98.72000122070312},{"date":1668436200,"open":95.5,"high":97.18000030517578,"low":95.11299896240234,"close":96.02999877929688,"volume":24170100,"adjclose":96.02999877929688},{"date":1668177000,"open":94.70999908447266,"high":97.36000061035156,"low":94.16000366210938,"close":96.7300033569336,"volume":30569100,"adjclose":96.7300033569336},{"date":1668090600,"open":92.33999633789062,"high":94.55000305175781,"low":91.6500015258789,"close":94.16999816894531,"volume":42371200,"adjclose":94.16999816894531},{"date":1668004200,"open":88.54499816894531,"high":89.48999786376953,"low":87.36000061035156,"close":87.4000015258789,"volume":26743900,"adjclose":87.4000015258789},{"date":1667917800,"open":89.16000366210938,"high":90.40499877929688,"low":87.6500015258789,"close":88.91000366210938,"volume":30172000,"adjclose":88.91000366210938},{"date":1667831400,"open":87.33999633789062,"high":88.94000244140625,"low":86.95999908447266,"close":88.6500015258789,"volume":26899900,"adjclose":88.6500015258789},{"date":1667568600,"open":85.51000213623047,"high":86.7300033569336,"low":83.87999725341797,"close":86.69999694824219,"volume":40173300,"adjclose":86.69999694824219},{"date":1667482200,"open":86.34500122070312,"high":86.55000305175781,"low":83.44999694824219,"close":83.48999786376953,"volume":48510400,"adjclose":83.48999786376953},{"date":1667395800,"open":90.91000366210938,"high":91.30000305175781,"low":87.01000213623047,"close":87.06999969482422,"volume":43553600,"adjclose":87.06999969482422},{"date":1667309400,"open":95.58999633789062,"high":96.16500091552734,"low":90.43000030517578,"close":90.5,"volume":43220600,"adjclose":90.5},{"date":1667223000,"open":95.77999877929688,"high":96.3499984741211,"low":94.37999725341797,"close":94.66000366210938,"volume":29868700,"adjclose":94.66000366210938},{"date":1666963800,"open":92.52999877929688,"high":96.86000061035156,"low":92.322998046875,"close":96.58000183105469,"volume":35696900,"adjclose":96.58000183105469},{"date":1666877400,"open":94.30999755859375,"high":95.16999816894531,"low":91.9000015258789,"close":92.5999984741211,"volume":54036500,"adjclose":92.5999984741211},{"date":1666791000,"open":96.76000213623047,"high":98.54000091552734,"low":94.56999969482422,"close":94.81999969482422,"volume":71504300,"adjclose":94.81999969482422},{"date":1666704600,"open":103.30000305175781,"high":105.0999984741211,"low":103.0199966430664,"close":104.93000030517578,"volume":29910200,"adjclose":104.93000030517578},{"date":1666618200,"open":102.08999633789062,"high":103.0999984741211,"low":100.30000305175781,"close":102.97000122070312,"volume":24680800,"adjclose":102.97000122070312},{"date":1666359000,"open":98.45999908447266,"high":101.62000274658203,"low":98.2300033569336,"close":101.4800033569336,"volume":28988700,"adjclose":101.4800033569336},{"date":1666272600,"open":100.81999969482422,"high":103,"low":99.97000122070312,"close":100.52999877929688,"volume":25125100,"adjclose":100.52999877929688},{"date":1666186200,"open":100.69999694824219,"high":101.65899658203125,"low":99.63500213623047,"close":100.29000091552734,"volume":21573700,"adjclose":100.29000091552734},{"date":1666099800,"open":103.94000244140625,"high":104.22000122070312,"low":100.6500015258789,"close":101.38999938964844,"volume":21610500,"adjclose":101.38999938964844},{"date":1666013400,"open":99.5199966430664,"high":101.7699966430664,"low":99.51000213623047,"close":100.77999877929688,"volume":23311600,"adjclose":100.77999877929688},{"date":1665754200,"open":100.625,"high":101.29000091552734,"low":97.02999877929688,"close":97.18000030517578,"volume":22624800,"adjclose":97.18000030517578},{"date":1665667800,"open":95.93000030517578,"high":100.52999877929688,"low":95.2699966430664,"close":99.70999908447266,"volume":32812200,"adjclose":99.70999908447266},{"date":1665581400,"open":98.2699966430664,"high":99.64800262451172,"low":97.66999816894531,"close":98.30000305175781,"volume":17343400,"adjclose":98.30000305175781},{"date":1665495000,"open":98.25,"high":100.12000274658203,"low":97.25,"close":98.05000305175781,"volume":21617700,"adjclose":98.05000305175781},{"date":1665408600,"open":99.8499984741211,"high":99.98999786376953,"low":97.87000274658203,"close":98.70999908447266,"volume":16529900,"adjclose":98.70999908447266},{"date":1665149400,"open":100.6500015258789,"high":101.41999816894531,"low":99.20999908447266,"close":99.56999969482422,"volume":24249900,"adjclose":99.56999969482422},{"date":1665063000,"open":101.5,"high":103.7300033569336,"low":101.5,"close":102.23999786376953,"volume":17156200,"adjclose":102.23999786376953},{"date":1664976600,"open":100.69000244140625,"high":102.73999786376953,"low":99.73999786376953,"close":102.22000122070312,"volume":18475500,"adjclose":102.22000122070312},{"date":1664890200,"open":101.04000091552734,"high":102.72000122070312,"low":101.04000091552734,"close":102.41000366210938,"volume":22580900,"adjclose":102.41000366210938},{"date":1664803800,"open":97.22000122070312,"high":99.97000122070312,"low":97.0199966430664,"close":99.30000305175781,"volume":24840000,"adjclose":99.30000305175781},{"date":1664544600,"open":97.7300033569336,"high":99.49400329589844,"low":96.02999877929688,"close":96.1500015258789,"volume":26277800,"adjclose":96.1500015258789},{"date":1664458200,"open":99.30000305175781,"high":99.30000305175781,"low":96.5199966430664,"close":98.08999633789062,"volume":21921500,"adjclose":98.08999633789062},{"date":1664371800,"open":98.0199966430664,"high":101.4000015258789,"low":97.80000305175781,"close":100.73999786376953,"volume":24617000,"adjclose":100.73999786376953},{"date":1664285400,"open":99.91000366210938,"high":100.45999908447266,"low":97.33999633789062,"close":98.08999633789062,"volume":24225000,"adjclose":98.08999633789062},{"date":1664199000,"open":98.61000061035156,"high":100.44000244140625,"low":98.37999725341797,"close":98.80999755859375,"volume":22437900,"adjclose":98.80999755859375},{"date":1663939800,"open":100.05999755859375,"high":100.11000061035156,"low":98.01000213623047,"close":99.16999816894531,"volume":25657000,"adjclose":99.16999816894531},{"date":1663853400,"open":99.44999694824219,"high":101.68000030517578,"low":99.41000366210938,"close":100.56999969482422,"volume":21272700,"adjclose":100.56999969482422},{"date":1663767000,"open":102.23999786376953,"high":103.48999786376953,"low":99.98999786376953,"close":100.01000213623047,"volume":26596800,"adjclose":100.01000213623047},{"date":1663680600,"open":102.87999725341797,"high":103.16999816894531,"low":101.12000274658203,"close":101.83000183105469,"volume":24001700,"adjclose":101.83000183105469},{"date":1663594200,"open":102.54000091552734,"high":104.0199966430664,"low":102.37000274658203,"close":103.8499984741211,"volume":19738600,"adjclose":103.8499984741211},{"date":1663335000,"open":102.97000122070312,"high":104.02999877929688,"low":101.8550033569336,"close":103.62999725341797,"volume":64540100,"adjclose":103.62999725341797},{"date":1663248600,"open":105.01000213623047,"high":106.20999908447266,"low":103.30999755859375,"close":103.9000015258789,"volume":26494900,"adjclose":103.9000015258789},{"date":1663162200,"open":105.44000244140625,"high":106.0999984741211,"low":104.5,"close":105.87000274658203,"volume":22115800,"adjclose":105.87000274658203},{"date":1663075800,"open":108.88999938964844,"high":109.37000274658203,"low":105,"close":105.30999755859375,"volume":33015000,"adjclose":105.30999755859375},{"date":1662989400,"open":111.98999786376953,"high":112.63999938964844,"low":110.93000030517578,"close":111.87000274658203,"volume":19732900,"adjclose":111.87000274658203},{"date":1662730200,"open":110.05000305175781,"high":112,"low":110,"close":111.77999877929688,"volume":21732900,"adjclose":111.77999877929688},{"date":1662643800,"open":109.18000030517578,"high":110.58000183105469,"low":108.05999755859375,"close":109.41999816894531,"volume":21660700,"adjclose":109.41999816894531},{"date":1662557400,"open":107.76000213623047,"high":110.98999786376953,"low":107.61499786376953,"close":110.4800033569336,"volume":22987200,"adjclose":110.4800033569336},{"date":1662471000,"open":108.13500213623047,"high":108.87999725341797,"low":106.51000213623047,"close":107.4800033569336,"volume":20565100,"adjclose":107.4800033569336},{"date":1662125400,"open":111.33999633789062,"high":111.67500305175781,"low":108.12999725341797,"close":108.68000030517578,"volume":20618100,"adjclose":108.68000030517578},{"date":1662039000,"open":109.19999694824219,"high":111.22000122070312,"low":108.19000244140625,"close":110.55000305175781,"volume":22784400,"adjclose":110.55000305175781},{"date":1661952600,"open":111.62999725341797,"high":111.7699966430664,"low":109.05000305175781,"close":109.1500015258789,"volume":25898000,"adjclose":109.1500015258789},{"date":1661866200,"open":111.02999877929688,"high":111.37000274658203,"low":108.80000305175781,"close":109.91000366210938,"volume":20548200,"adjclose":109.91000366210938},{"date":1661779800,"open":110.77999877929688,"high":111.95999908447266,"low":109.80999755859375,"close":110.33999633789062,"volume":20386100,"adjclose":110.33999633789062},{"date":1661520600,"open":115.80999755859375,"high":116.5999984741211,"low":111.22000122070312,"close":111.30000305175781,"volume":31698700,"adjclose":111.30000305175781},{"date":1661434200,"open":115.1500015258789,"high":117.77999877929688,"low":115.05000305175781,"close":117.69999694824219,"volume":14874700,"adjclose":117.69999694824219},{"date":1661347800,"open":114.44999694824219,"high":115.71700286865234,"low":113.77999877929688,"close":114.69999694824219,"volume":16051200,"adjclose":114.69999694824219},{"date":1661261400,"open":114.31999969482422,"high":115.93000030517578,"low":114.30000305175781,"close":114.7699966430664,"volume":14390700,"adjclose":114.7699966430664},{"date":1661175000,"open":116.0999984741211,"high":116.5,"low":114.66999816894531,"close":115.06999969482422,"volume":19316000,"adjclose":115.06999969482422},{"date":1660915800,"open":119.87000274658203,"high":120,"low":117.66999816894531,"close":118.12000274658203,"volume":20187000,"adjclose":118.12000274658203},{"date":1660829400,"open":120.2300033569336,"high":121.69000244140625,"low":119.55000305175781,"close":120.86000061035156,"volume":15652000,"adjclose":120.86000061035156},{"date":1660743000,"open":120.93000030517578,"high":122.1500015258789,"low":120.19999694824219,"close":120.31999969482422,"volume":17589200,"adjclose":120.31999969482422},{"date":1660656600,"open":122.31999969482422,"high":123.22799682617188,"low":121.53500366210938,"close":122.51000213623047,"volume":15626200,"adjclose":122.51000213623047},{"date":1660570200,"open":122.20999908447266,"high":123.26000213623047,"low":121.56999969482422,"close":122.87999725341797,"volume":15525000,"adjclose":122.87999725341797},{"date":1660311000,"open":121.16000366210938,"high":122.6500015258789,"low":120.4000015258789,"close":122.6500015258789,"volume":16121100,"adjclose":122.6500015258789},{"date":1660224600,"open":122.08000183105469,"high":122.33999633789062,"low":119.55000305175781,"close":119.81999969482422,"volume":16671600,"adjclose":119.81999969482422},{"date":1660138200,"open":119.58999633789062,"high":121.77999877929688,"low":119.36000061035156,"close":120.6500015258789,"volume":20497000,"adjclose":120.6500015258789},{"date":1660051800,"open":117.98999786376953,"high":118.19999694824219,"low":116.55999755859375,"close":117.5,"volume":15424300,"adjclose":117.5},{"date":1659965400,"open":119.12000274658203,"high":120.86000061035156,"low":117.83000183105469,"close":118.13999938964844,"volume":17061100,"adjclose":118.13999938964844},{"date":1659706200,"open":116.93000030517578,"high":118.86000061035156,"low":116.70999908447266,"close":118.22000122070312,"volume":15615700,"adjclose":118.22000122070312},{"date":1659619800,"open":118.30000305175781,"high":119.5,"low":117.70999908447266,"close":118.87000274658203,"volume":15757700,"adjclose":118.87000274658203},{"date":1659533400,"open":116.33999633789062,"high":119.41999816894531,"low":116.1500015258789,"close":118.77999877929688,"volume":25302800,"adjclose":118.77999877929688},{"date":1659447000,"open":114.43000030517578,"high":117.08000183105469,"low":114.26000213623047,"close":115.9000015258789,"volume":17911000,"adjclose":115.9000015258789},{"date":1659360600,"open":115.52999877929688,"high":117.12000274658203,"low":114.69000244140625,"close":115.4800033569336,"volume":22856200,"adjclose":115.4800033569336},{"date":1659101400,"open":113.4000015258789,"high":116.9000015258789,"low":113.2300033569336,"close":116.63999938964844,"volume":31336200,"adjclose":116.63999938964844},{"date":1659015000,"open":112.80000305175781,"high":114.69999694824219,"low":111.85099792480469,"close":114.58999633789062,"volume":23303800,"adjclose":114.58999633789062},{"date":1658928600,"open":109.5999984741211,"high":114.4000015258789,"low":108.41999816894531,"close":113.5999984741211,"volume":41474600,"adjclose":113.5999984741211},{"date":1658842200,"open":107.43000030517578,"high":107.73999786376953,"low":104.76000213623047,"close":105.44000244140625,"volume":36626600,"adjclose":105.44000244140625},{"date":1658755800,"open":108.87999725341797,"high":110.58000183105469,"low":107.01000213623047,"close":108.20999908447266,"volume":28289900,"adjclose":108.20999908447266},{"date":1658496600,"open":111.80999755859375,"high":113.18000030517578,"low":107.5999984741211,"close":108.36000061035156,"volume":44455300,"adjclose":108.36000061035156},{"date":1658410200,"open":115.08999633789062,"high":115.20999908447266,"low":111.91000366210938,"close":115.04000091552734,"volume":27267800,"adjclose":115.04000091552734},{"date":1658323800,"open":114.05999755859375,"high":116.33000183105469,"low":113.26000213623047,"close":114.69999694824219,"volume":26780100,"adjclose":114.69999694824219},{"date":1658237400,"open":111.7300033569336,"high":114.80999755859375,"low":110.5,"close":114.62000274658203,"volume":30992300,"adjclose":114.62000274658203},{"date":1658151000,"open":113.44000244140625,"high":114.80000305175781,"low":109.30000305175781,"close":109.91000366210938,"volume":33354000,"adjclose":109.91000366210938},{"date":1658151000,"numerator":20,"denominator":1,"splitRatio":"20:1","type":"SPLIT","data":"20:1"},{"date":1657891800,"open":112.96299743652344,"high":114.00050354003906,"low":111.82250213623047,"close":112.76699829101562,"volume":34330000,"adjclose":112.76699829101562},{"date":1657805400,"open":110.82599639892578,"high":111.98750305175781,"low":109.32550048828125,"close":111.44000244140625,"volume":32366000,"adjclose":111.44000244140625},{"date":1657719000,"open":112.63899993896484,"high":115.15699768066406,"low":111.822998046875,"close":112.18699645996094,"volume":38958000,"adjclose":112.18699645996094},{"date":1657632600,"open":116.8385009765625,"high":117.84950256347656,"low":114.61499786376953,"close":114.84950256347656,"volume":24970000,"adjclose":114.84950256347656},{"date":1657546200,"open":118.6500015258789,"high":118.79450225830078,"low":116.2344970703125,"close":116.52249908447266,"volume":26718000,"adjclose":116.52249908447266},{"date":1657287000,"open":117.55000305175781,"high":120.43499755859375,"low":117.51399993896484,"close":120.16850280761719,"volume":29082000,"adjclose":120.16850280761719},{"date":1657200600,"open":116.00800323486328,"high":119.86199951171875,"low":115.53399658203125,"close":119.30599975585938,"volume":32184000,"adjclose":119.30599975585938},{"date":1657114200,"open":114.09200286865234,"high":116.35199737548828,"low":112.25050354003906,"close":115.2135009765625,"volume":28852000,"adjclose":115.2135009765625},{"date":1657027800,"open":107.5145034790039,"high":114.05259704589844,"low":106.24949645996094,"close":113.88700103759766,"volume":36398000,"adjclose":113.88700103759766},{"date":1656682200,"open":108.33699798583984,"high":109.80635070800781,"low":107.1050033569336,"close":109.08100128173828,"volume":31028000,"adjclose":109.08100128173828},{"date":1656595800,"open":110.49949645996094,"high":111.32980346679688,"low":107.30999755859375,"close":109.37249755859375,"volume":38046000,"adjclose":109.37249755859375},{"date":1656509400,"open":112.14849853515625,"high":113.66449737548828,"low":111.55400085449219,"close":112.25650024414062,"volume":18628000,"adjclose":112.25650024414062},{"date":1656423000,"open":116.35099792480469,"high":117.85649871826172,"low":112.44400024414062,"close":112.57150268554688,"volume":28232000,"adjclose":112.57150268554688},{"date":1656336600,"open":118.93499755859375,"high":119.25,"low":116.00074768066406,"close":116.62249755859375,"volume":32840000,"adjclose":116.62249755859375},{"date":1656077400,"open":113.60299682617188,"high":118.63749694824219,"low":113.60299682617188,"close":118.53800201416016,"volume":39122000,"adjclose":118.53800201416016}]';

        $historyData = json_decode($jsonString, true);

        $startDate = Carbon::now()->addDays(-5)->format('Y-m-d');
        $endDate = Carbon::now()->addDays(-4)->format('Y-m-d');
        $timestampStart = Carbon::parse($startDate)->getTimestamp(); // Smallest
        $timestampEnd = Carbon::parse($endDate)->getTimestamp(); // Biggest

        $filteredData = $companyService->filterHistoryDataByDateRange($historyData, $startDate, $endDate);
        $this->assertIsArray($filteredData);

        $dates = array_column($filteredData, 'date');

        sort($dates);

        $first = $dates[0]; // Smaller
        $last = $dates[count($dates) - 1]; // Bigger

        // Assert that $timestampStart is equal to or less than $first
        $this->assertLessThanOrEqual($first, $timestampStart);

        // Assert that $timestampStart is equal to or greater than $last
        $this->assertGreaterThanOrEqual($last, $timestampEnd);
    }
}
